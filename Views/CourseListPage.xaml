<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="StudentProgressTracker.Views.CourseListPage"
             xmlns:viewmodels="clr-namespace:StudentProgressTracker.ViewModels"
             xmlns:models="clr-namespace:StudentProgressTracker.Models"
             x:DataType="viewmodels:CourseListViewModel"
             Title="Courses">
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Login" Order="Secondary" Clicked="LoginToolbarItem_Clicked" />
    </ContentPage.ToolbarItems>
    <Shell.BackButtonBehavior>
        <BackButtonBehavior IsEnabled="True" IsVisible="True" />
    </Shell.BackButtonBehavior>
    <Grid RowDefinitions="*,Auto">
        <Grid RowDefinitions="Auto,Auto,*,Auto" Padding="16">
            <Label Text="{Binding CurrentTerm.Title}" Style="{StaticResource Headline}" />
            <Label Grid.Row="1" Text="{Binding CourseCountDisplay}" TextColor="{StaticResource Charcoal}" />

            <CollectionView Grid.Row="2" ItemsSource="{Binding Courses}" SelectionMode="None">
                <CollectionView.EmptyView>
                    <Label Text="No courses yet. Tap + Add Course" TextColor="{StaticResource Charcoal}" HorizontalTextAlignment="Center" VerticalTextAlignment="Center" />
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Course">
                        <Frame Padding="12" Margin="0,8" HasShadow="False" BorderColor="{StaticResource Gray200}">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.CourseTappedCommand}"
                                                      CommandParameter="{Binding .}" />
                            </Frame.GestureRecognizers>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Label Text="{Binding Title}" FontAttributes="Bold" TextColor="{StaticResource Charcoal}" />
                                <Label Grid.Row="1">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{Binding StartDate, StringFormat='{}{0:MMM dd, yyyy}'}" />
                                            <Span Text=" - " />
                                            <Span Text="{Binding EndDate, StringFormat='{}{0:MMM dd, yyyy}'}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                                <Label Grid.Row="2" Text="{Binding Status}" TextColor="{StaticResource AccentTeal}" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Grid Grid.Row="3" ColumnDefinitions="*,Auto" VerticalOptions="End">
                <ActivityIndicator IsRunning="{Binding IsLoading}" IsVisible="{Binding IsLoading}" HorizontalOptions="Start" />
                <Button Grid.Column="1" Text="+ Add Course" Style="{StaticResource SecondaryButtonStyle}" IsEnabled="{Binding CanAddCourse}" Command="{Binding AddCommand}" />
            </Grid>
        </Grid>
        
        <!-- Back Button at Bottom -->
        <Button Grid.Row="1"
                Text="â† Back" 
                Command="{Binding GoBackCommand}"
                BackgroundColor="{StaticResource Secondary}"
                TextColor="{StaticResource Charcoal}"
                FontSize="14"
                FontAttributes="Bold"
                CornerRadius="8"
                HeightRequest="40"
                WidthRequest="120"
                HorizontalOptions="Center"
                Margin="0,8" />
    </Grid>
</ContentPage>






